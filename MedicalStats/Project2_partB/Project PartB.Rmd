---
title: "MAS61002 Project Part B  \n Registration Number: 210138744"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(survival)
library(dplyr)
library(ggplot2)
data <- load("Data/E_PartB_data.RData")
```

# Question 1

# Question 1.1
```{r include=TRUE, results='asis', figures-side, fig.show="hold", out.width="50%"}
library(knitr) # for prettier tables
library(pander) #for adding pandoc headers
library(ggfortify) # so we can use fortify to create a datatable required for knitr
options(digits = 3) # let's keep output to sensible number of places
trialA <- q1dat %>% filter(drug == "A")
trialB <- q1dat %>% filter(drug == "B")

trialA.sv <- Surv(time=trialA$time, event=trialA$status, type="right")
trialASurv <- survfit(trialA.sv ~ 1, data = trialA)
tableA <- fortify(trialASurv) %>% rename(survival=surv, "lower 95% CI"=lower, "upper 95% CI"= upper) %>% select(1, 2, 3, 5, 6, 8, 7)
pandoc.header(list("Kaplan-Meier Estimate of Survivor Function for trial drug A"), level = 2)
print(kable(tableA))

trialB.sv <- Surv(time=trialB$time, event=trialB$status, type="right")
trialBSurv <- survfit(trialB.sv ~ 1, data = trialB)
tableB <- fortify(trialBSurv) %>% rename(survival=surv, "lower 95% CI"=lower, "upper 95% CI"= upper) %>% select(1, 2, 3, 5, 6, 8, 7)
pandoc.header(list("Kaplan-Meier Estimate of Survivor Function for trial drug B"), level = 2)
print(kable(tableB))

par(mar = c(4, 4, .1, .1))
plot(trialASurv, xlab ="months", ylab = "probablity of survival")
title("Kaplan-Meier  plot of trial A drug", line= -1 )
plot(trialBSurv, xlab ="months", ylab = "probablity of survival")
title( "Kaplan-Meier  plot of trial B drug", line= -1 )


```


# Question 1.2
Things to comments on: earliest death, average death, calculate rough quartiles. longest death. Look at error bounds. Number of people in the study. number who were censored.

# Question 1.3
Answer to Question 1.3 here

# Question 2

# Question 2.1
```{r include=TRUE}
q2 <- q2dat #use shorter name so most code is visible. I dislike attach as is less explict.
lungcancer.sv <- Surv(time=q2$time, event=q2$stat, type="right")
lungcancer.regexp <- survreg(lungcancer.sv ~ q2$sex + q2$exer + q2$smok + q2$trea + q2$age, dist="exponential")
summary(lungcancer.regexp)
```
Therefore the accelerated failure time model with an expoential failure time distribution and explanatory variables **x** is:

$$ \begin{aligned}
S(t;\mathbf{x}) &= exp\{{-t\: exp(-(\beta_0 + \beta_1x_{1} + \beta_2x_{2} + \beta_3x_{3} + \beta_4x_{4} + \beta_5x_{5}))}\}\\
&= exp\{{-t\: exp(-(\beta_0 + \beta_1x_{sex} + \beta_2x_{exer} + \beta_3x_{smok} + \beta_4x_{trea} + \beta_5x_{age}))}\}\\
&= exp\{{-t\: exp(-(0.5017 - 0.5328x_{sex} - 0.2566x_{exer} - 0.8821x_{smok} + 0.8144x_{trea} - 0.0113x_{age}))}\}\\
&= exp\{{-t\: exp(-0.5017 + 0.5328x_{sex} + 0.2566x_{exer} + 0.8821x_{smok} - 0.8144x_{trea} + 0.0113x_{age})}\}\\
\end{aligned}
$$

Variable     Coding
--------    -------------------------------------------------------------
sex         0 = male; 1 = female
exer        0 = some exercise; 1 = rarely exercise
smok        0 = not current smoker; 1 = current smoker
trea        0 = treatment A; 1 = treatment B
age         age of patient centred on 50 years (i.e. 60 years old is 10)
t           survival time (years)

# Question 2.2
Answer to Question 2.2 here

# Question 2.3
Answer to Question 2.3 here

# Question 2.4
Answer to Question 2.4 here


